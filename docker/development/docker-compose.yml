version: "3.9"

services:
  speedtest:
    container_name: speedtest-development
    build:
      context: ../..  # Project root
      dockerfile: docker/development/Dockerfile
    environment:
      SLEEP_SECONDS: ${SLEEP_SECONDS:-30}  # Default: 30 seconds for development
      RESULT_DIR: /app/results
      LOG_DIR: /app/logs
      UPLOAD_DIR: /app/uploads
      # AWS bootstrap (required to assume role and access SSM)
      AWS_REGION: ${AWS_REGION:-eu-west-2}
      AWS_ROLE_ARN: ${AWS_ROLE_ARN}
      SSM_PATH_PREFIX: ${SSM_PATH_PREFIX}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    volumes:
      # Mount source code for hot-reload
      - ../../speedsnake:/app/speedsnake:ro
      # Mount data directories
      - ../../results:/app/results
      - ../../logs:/app/logs
      - ../../uploads:/app/uploads
      # Mount tests for running in container
      - ../../tests:/app/tests:ro
    # Override command for development (uses uv for hot-reload support)
    command: ["python", "-m", "speedsnake.handlers.loop"]
